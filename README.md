# üé¨ Sistema de Upload de V√≠deos

[![PHP](https://img.shields.io/badge/PHP-8.2+-777BB4?logo=php&logoColor=white)](https://php.net)
[![Laravel](https://img.shields.io/badge/Laravel-12-FF2D20?logo=laravel&logoColor=white)](https://laravel.com)
[![AWS S3](https://img.shields.io/badge/AWS-S3-FF9900?logo=amazon-aws&logoColor=white)](https://aws.amazon.com/s3/)
[![Tests](https://img.shields.io/badge/Tests-7%20passing-green)](./tests)

**Sistema completo para fazer upload de v√≠deos**.

> üí° **Para iniciantes:** Este sistema permite que voc√™ envie v√≠deos pela internet e os armazene na nuvem (AWS S3) de forma segura e organizada.

## üöÄ O que este sistema faz?

‚úÖ **Upload de v√≠deos** - Envie v√≠deos MP4, MOV, AVI e outros formatos  
‚úÖ **Armazenamento seguro** - Seus v√≠deos ficam salvos na nuvem AWS  
‚úÖ **Organiza√ß√£o autom√°tica** - Lista e organiza todos os v√≠deos  
‚úÖ **Informa√ß√µes dos v√≠deos** - Mostra dura√ß√£o, tamanho e resolu√ß√£o  
‚úÖ **API completa** - Interface para desenvolvedores

## üìã Guia R√°pido

- [üéØ **Como usar (Postman)**](#-como-testar-upload) ‚≠ê **Comece aqui!**
- [‚ö° **Instala√ß√£o simples**](#-instala√ß√£o)
- [‚öôÔ∏è **Configura√ß√£o b√°sica**](#Ô∏è-configura√ß√£o)
- [üéØ **Todas as funcionalidades**](#-api-endpoints)
- [‚ùì **Problemas e solu√ß√µes**](#-faq-e-troubleshooting)

## üöÄ Funcionalidades

### Core Features
- ‚úÖ **Upload de v√≠deos** para AWS S3 com valida√ß√£o rigorosa
- ‚úÖ **Extra√ß√£o de metadados** autom√°tica (FFmpeg/Mock)
- ‚úÖ **API REST completa** (CRUD operations)
- ‚úÖ **Sistema de filas** para processamento ass√≠ncrono
- ‚úÖ **Valida√ß√£o de arquivos** (tipo, tamanho, integridade)
- ‚úÖ **UUIDs √∫nicos** para identifica√ß√£o segura

### Arquitetura & Qualidade
- ‚úÖ **Arquitetura SOLID** implementada com interfaces
- ‚úÖ **Inje√ß√£o de depend√™ncias** configurada
- ‚úÖ **Testes automatizados** (PHPUnit)
- ‚úÖ **Tratamento de erros** robusto
- ‚úÖ **Logs estruturados** para debugging
- ‚úÖ **Rollback autom√°tico** em caso de falhas

## üõ†Ô∏è Tecnologias

| Categoria | Tecnologia | Vers√£o | Descri√ß√£o |
|-----------|------------|--------|-----------|
| **Backend** | PHP | 8.2+ | Linguagem principal |
| **Framework** | Laravel | 12.x | Framework web moderno |
| **Storage** | AWS S3 | Latest | Armazenamento de v√≠deos |
| **Database** | MySQL | 8.0+ | Banco de dados relacional |
| **Media** | FFmpeg | Latest | Processamento de v√≠deos |
| **Queue** | Laravel Queue | Built-in | Sistema de filas |
| **Testing** | PHPUnit | 11.x | Testes automatizados |

## ‚ö° Instala√ß√£o

> üéØ **Objetivo:** Colocar o sistema funcionando em 5 minutos

### üìã Voc√™ precisa ter instalado:

- **PHP 8.2+** ([Download aqui](https://www.php.net/downloads))
- **Composer** ([Download aqui](https://getcomposer.org/download/))
- **MySQL/XAMPP** ([Download XAMPP](https://www.apachefriends.org/))
- **Conta AWS** com S3 ([Criar conta](https://aws.amazon.com/pt/s3/))

### üöÄ Instala√ß√£o em 5 passos:

```bash
# 1Ô∏è‚É£ Clone o projeto
git clone https://github.com/EmanuelSgx/projeto-video.git
cd projeto-video

# 2Ô∏è‚É£ Instale as depend√™ncias
composer install

# 3Ô∏è‚É£ Configure o ambiente
copy .env.example .env
php artisan key:generate

# 4Ô∏è‚É£ Configure banco de dados (veja pr√≥xima se√ß√£o)

# 5Ô∏è‚É£ Inicie o servidor
php artisan migrate
php artisan serve
```

‚úÖ **Pronto!** Acesse: `http://localhost:8000`

## ‚öôÔ∏è Configura√ß√£o

> üéØ **Objetivo:** Configurar banco de dados e AWS em 3 minutos

### 1Ô∏è‚É£ Abra o arquivo `.env` e configure:

```env
# üìä BANCO DE DADOS (MySQL/XAMPP)
DB_DATABASE=video_upload_db
DB_USERNAME=root
DB_PASSWORD=sua_senha

# ‚òÅÔ∏è AWS S3 (OBRIGAT√ìRIO para upload)
AWS_ACCESS_KEY_ID=sua_access_key
AWS_SECRET_ACCESS_KEY=sua_secret_key
AWS_DEFAULT_REGION=sa-east-1
AWS_BUCKET=seu-bucket-videos
```

### 2Ô∏è‚É£ Como obter credenciais AWS:

1. Entre na [AWS Console](https://console.aws.amazon.com/)
2. V√° em **IAM** ‚Üí **Users** ‚Üí **Create User**
3. D√™ permiss√µes de **S3** para o usu√°rio
4. Copie **Access Key** e **Secret Key**
5. Crie um **Bucket S3** e anote o nome

### 3Ô∏è‚É£ Finalize a configura√ß√£o:

```bash
# Crie o banco de dados
php artisan migrate
```

‚úÖ **Configura√ß√£o completa!**

## üéØ O que voc√™ pode fazer

> üéØ **Todas as funcionalidades dispon√≠veis**

| ‚ú® A√ß√£o | üåê Endpoint | üìù Descri√ß√£o |
|---------|-------------|--------------|
| üì§ **Fazer upload** | `POST /api/videos` | Enviar um v√≠deo |
| üìã **Ver todos os v√≠deos** | `GET /api/videos` | Listar v√≠deos enviados |
| üîç **Ver um v√≠deo** | `GET /api/videos/{id}` | Detalhes de um v√≠deo |
| üóëÔ∏è **Apagar v√≠deo** | `DELETE /api/videos/{id}` | Remover v√≠deo |
| ‚úÖ **Testar conex√£o** | `GET /api/videos/validate/s3` | Verificar se est√° funcionando |

### üìÅ Tipos de v√≠deo aceitos:
‚úÖ **MP4** | ‚úÖ **MOV** | ‚úÖ **AVI** | ‚úÖ **WEBM** | ‚úÖ **WMV**

### üìè Limites:
- **Tamanho m√°ximo:** 100MB por v√≠deo
- **URL base:** `http://localhost:8000/api`

## üì§ Como Testar Upload

> üéØ **Guia passo a passo para enviar seu primeiro v√≠deo**

### üîß Usando Postman (Recomendado)

#### 1Ô∏è‚É£ Configure o Postman:
- **M√©todo:** `POST`
- **URL:** `http://127.0.0.1:8000/api/videos`

#### 2Ô∏è‚É£ Adicione os Headers necess√°rios:
```
Accept: application/json
X-Requested-With: XMLHttpRequest
```

> ‚ö†Ô∏è **IMPORTANTE:** N√ÉO adicione `Content-Type` - o Postman faz isso automaticamente!

#### 3Ô∏è‚É£ Selecione o arquivo:
1. V√° na aba **Body**
2. Escolha **form-data**
3. Adicione um campo:
   - **Key:** `video` (tem que ser exatamente assim)
   - **Tipo:** **File** (n√£o Text!)
   - **Value:** Clique em "Select Files" e escolha seu v√≠deo

#### 4Ô∏è‚É£ Clique em **Send**!

### ‚úÖ Resposta de sucesso:
```json
{
    "success": true,
    "data": {
        "uuid": "abc-123-def",
        "original_name": "meu-video.mp4",
        "status": "uploaded"
    },
    "message": "Video uploaded successfully"
}
```

### üíª Usando Terminal (Alternativa):

```powershell
# Windows PowerShell
curl -X POST "http://127.0.0.1:8000/api/videos" `
  -H "Accept: application/json" `
  -H "X-Requested-With: XMLHttpRequest" `
  -F "video=@C:\caminho\para\video.mp4"
```

## üìä Exemplos de Uso

### 1. Upload de V√≠deo

**Request:**
```bash
curl -X POST http://localhost:8000/api/videos \
  -F "video=@meu-video.mp4" \
  -H "Accept: application/json" \
  -H "X-Requested-With: XMLHttpRequest"
```

**Response (201 Created):**
```json
{
  "success": true,
  "data": {
    "id": 1,
    "uuid": "550e8400-e29b-41d4-a716-446655440000",
    "original_name": "meu-video.mp4",
    "resolution": "1920x1080",
    "duration": 120,
    "formatted_duration": "00:02:00",
    "file_size": 15728640,
    "formatted_file_size": "15.00 MB",
    "mime_type": "video/mp4",
    "status": "uploaded",
    "s3_path": "https://bucket.s3.region.amazonaws.com/videos/uuid/file.mp4",
    "created_at": "2025-06-04T17:00:00.000000Z"
  },
  "message": "Video uploaded successfully"
}
```

### 2. Listar V√≠deos

**Request:**
```bash
curl -X GET http://localhost:8000/api/videos \
  -H "Accept: application/json"
```

**Response (200 OK):**
```json
{
  "success": true,
  "data": {
    "data": [
      {
        "id": 1,
        "uuid": "550e8400-e29b-41d4-a716-446655440000",
        "original_name": "video1.mp4",
        "resolution": "1920x1080",
        "formatted_duration": "00:02:00",
        "formatted_file_size": "15.00 MB",
        "status": "uploaded",
        "created_at": "2025-06-04T17:00:00.000000Z"
      }
    ],
    "current_page": 1,
    "total": 1
  }
}
```

### 3. Buscar V√≠deo Espec√≠fico

**Request:**
```bash
curl -X GET http://localhost:8000/api/videos/550e8400-e29b-41d4-a716-446655440000 \
  -H "Accept: application/json"
```

### 4. Validar Conex√£o S3

**Request:**
```bash
curl -X GET http://localhost:8000/api/videos/validate/s3 \
  -H "Accept: application/json"
```

**Response:**
```json
{
  "success": true,
  "message": "S3 connection is working properly",
  "data": {
    "bucket": "seu-bucket-videos",
    "region": "sa-east-1",
    "status": "connected"
  }
}
```

### Tratamento de Erros

**Arquivo muito grande (422):**
```json
{
  "message": "File size exceeds maximum allowed size of 100MB",
  "errors": {
    "video": ["File size exceeds maximum allowed size of 100MB"]
  }
}
```

**Tipo inv√°lido (422):**
```json
{
  "message": "Video must be of type: mp4, mov, avi, webm, wmv.",
  "errors": {
    "video": ["Video must be of type: mp4, mov, avi, webm, wmv."]
  }
}
```

## üß™ Testes

### Testes Automatizados

```bash
# Executar todos os testes
./vendor/bin/phpunit

# Testes com coverage
./vendor/bin/phpunit --coverage-html coverage/

# Testes espec√≠ficos
./vendor/bin/phpunit tests/Feature/VideoUploadTest.php
```

### Testes Manuais

```bash
# Teste completo do sistema
php tests/scripts/simple-system-test.php

# Teste espec√≠fico S3
php tests/scripts/test-s3-connection.php

# Valida√ß√£o completa
php tests/scripts/validate-s3.php
```

### Status dos Testes

```
‚úÖ PHPUnit: 7 tests, 18 assertions (100% passing)
‚úÖ Upload functionality: Working
‚úÖ S3 integration: Connected
‚úÖ Metadata extraction: Functional
‚úÖ API endpoints: All active
‚úÖ Database operations: Stable
```

## üèóÔ∏è Arquitetura

### Princ√≠pios SOLID Implementados

#### 1. **Single Responsibility Principle (SRP)**
- `VideoUploadService`: Apenas upload de v√≠deos
- `S3FileStorageService`: Apenas opera√ß√µes S3
- `FFmpegVideoMetadataExtractor`: Apenas extra√ß√£o de metadados

#### 2. **Open/Closed Principle (OCP)**
- Sistema extens√≠vel via interfaces
- Novos storages podem ser adicionados facilmente

#### 3. **Liskov Substitution Principle (LSP)**
- Implementa√ß√µes s√£o intercambi√°veis
- Mock e FFmpeg s√£o substitu√≠veis

#### 4. **Interface Segregation Principle (ISP)**
- Interfaces espec√≠ficas e focadas
- Sem depend√™ncias desnecess√°rias

#### 5. **Dependency Inversion Principle (DIP)**
- Depend√™ncia de abstra√ß√µes, n√£o implementa√ß√µes
- Inje√ß√£o de depend√™ncias configurada

### Fluxo de Upload

```mermaid
graph TD
    A[Client] -->|POST /api/videos| B[VideoController]
    B --> C[VideoUploadService]
    C --> D[Validate File]
    D --> E[Extract Metadata]
    E --> F[Upload to S3]
    F --> G[Save to Database]
    G --> H[Send to Queue]
    H --> I[Return Response]
```

## üìÅ Estrutura do Projeto

```
üì¶ projeto-video/
‚îú‚îÄ‚îÄ üéØ app/
‚îÇ   ‚îú‚îÄ‚îÄ Console/Commands/        # Comandos Artisan personalizados
‚îÇ   ‚îú‚îÄ‚îÄ Contracts/              # Interfaces (SOLID)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FileStorageInterface.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ QueueServiceInterface.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ VideoMetadataExtractorInterface.php
‚îÇ   ‚îú‚îÄ‚îÄ Http/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Controllers/        # Controllers da API
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Requests/          # Form Requests para valida√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ Models/                # Modelos Eloquent
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ User.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Video.php
‚îÇ   ‚îú‚îÄ‚îÄ Providers/             # Service Providers
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AppServiceProvider.php
‚îÇ   ‚îî‚îÄ‚îÄ Services/              # L√≥gica de neg√≥cio
‚îÇ       ‚îú‚îÄ‚îÄ FFmpegVideoMetadataExtractor.php
‚îÇ       ‚îú‚îÄ‚îÄ LaravelQueueService.php
‚îÇ       ‚îú‚îÄ‚îÄ MockVideoMetadataExtractor.php
‚îÇ       ‚îú‚îÄ‚îÄ S3FileStorageService.php
‚îÇ       ‚îî‚îÄ‚îÄ VideoUploadService.php
‚îú‚îÄ‚îÄ üóÑÔ∏è database/
‚îÇ   ‚îú‚îÄ‚îÄ factories/             # Factories para testes
‚îÇ   ‚îú‚îÄ‚îÄ migrations/            # Migra√ß√µes do banco
‚îÇ   ‚îî‚îÄ‚îÄ seeders/              # Seeders
‚îú‚îÄ‚îÄ üß™ tests/
‚îÇ   ‚îú‚îÄ‚îÄ Feature/              # Testes de feature
‚îÇ   ‚îú‚îÄ‚îÄ Unit/                 # Testes unit√°rios
‚îÇ   ‚îî‚îÄ‚îÄ scripts/              # Scripts de teste manual
‚îú‚îÄ‚îÄ üìù config/                # Configura√ß√µes do Laravel
‚îú‚îÄ‚îÄ üõ§Ô∏è routes/                 # Defini√ß√£o de rotas
‚îú‚îÄ‚îÄ üìö Documenta√ß√£o/
‚îÇ   ‚îú‚îÄ‚îÄ README.md
‚îÇ   ‚îú‚îÄ‚îÄ DOCUMENTATION.md
‚îÇ   ‚îî‚îÄ‚îÄ postman-collection.json
‚îî‚îÄ‚îÄ ‚öôÔ∏è Arquivos de configura√ß√£o
    ‚îú‚îÄ‚îÄ .env.example
    ‚îú‚îÄ‚îÄ composer.json
    ‚îî‚îÄ‚îÄ phpunit.xml
```

## üîß Comandos Artisan

### Comandos Dispon√≠veis

```bash
# Listar arquivos S3 e sincronizar com banco
php artisan videos:list-s3-files

# Limpar cache da aplica√ß√£o
php artisan cache:clear

# Executar migrations
php artisan migrate

# Executar seeders
php artisan db:seed

# Gerar chave da aplica√ß√£o
php artisan key:generate
```

### Comandos de Desenvolvimento

```bash
# Modo de desenvolvimento com reload autom√°tico
php artisan serve

# Executar workers da fila
php artisan queue:work

# Monitorar logs em tempo real
tail -f storage/logs/laravel.log
```

## üîß Comandos √öteis

### Servidor de Desenvolvimento
```bash
# Iniciar servidor Laravel
php artisan serve

# Servidor com host espec√≠fico
php artisan serve --host=0.0.0.0 --port=8000
```

### Banco de Dados
```bash
# Executar migra√ß√µes
php artisan migrate

# Status das migra√ß√µes
php artisan migrate:status

# Rollback √∫ltima migra√ß√£o
php artisan migrate:rollback

# Resetar banco de dados
php artisan migrate:fresh
```

### Cache e Configura√ß√£o
```bash
# Limpar todos os caches
php artisan optimize:clear

# Comandos espec√≠ficos
php artisan config:clear
php artisan route:clear
php artisan cache:clear
php artisan view:clear
```

### Filas e Jobs
```bash
# Executar worker da fila
php artisan queue:work

# Executar jobs pendentes
php artisan queue:work --once

# Verificar jobs falhados
php artisan queue:failed
```

### Logs e Debug
```bash
# Monitorar logs em tempo real (Linux/macOS)
tail -f storage/logs/laravel.log

# Monitorar logs (Windows PowerShell)
Get-Content storage/logs/laravel.log -Tail 10 -Wait

# Verificar √∫ltimas linhas do log
tail -n 50 storage/logs/laravel.log
```

### API e Rotas
```bash
# Listar todas as rotas
php artisan route:list

# Filtrar rotas da API
php artisan route:list --path=api

# Verificar configura√ß√£o espec√≠fica
php artisan config:show filesystems.disks.s3
```

### Testes
```bash
# Executar todos os testes
php artisan test

# Executar testes espec√≠ficos
php artisan test --filter VideoUploadTest

# Testes com coverage
php artisan test --coverage
```

## ‚ùì FAQ e Troubleshooting

### üö® Problemas Comuns

#### **Erro 404 no Postman**
**Problema:** `Not Found` ao fazer POST para `/api/videos`

**Solu√ß√µes:**
1. Verifique se o servidor est√° rodando: `php artisan serve`
2. Adicione os headers obrigat√≥rios:
   - `Accept: application/json`
   - `X-Requested-With: XMLHttpRequest`
3. Confirme a URL: `http://127.0.0.1:8000/api/videos`

#### **"Video file is required"**
**Problema:** Erro 422 mesmo selecionando arquivo

**Solu√ß√µes:**
1. Certifique-se de que o campo se chama `video` (min√∫sculo)
2. Verifique se o tipo do campo √© **File** (n√£o Text)
3. Remova qualquer header `Content-Type` manual

#### **Erro 500 Internal Server Error**
**Problema:** Erro interno do servidor

**Solu√ß√µes:**
1. Verifique os logs: `storage/logs/laravel.log`
2. Confirme conex√£o com banco: `php artisan migrate:status`
3. Verifique configura√ß√£o AWS no `.env`
4. Execute: `php artisan config:clear`

#### **Arquivo muito grande**
**Problema:** Erro 422 para arquivos grandes

**Solu√ß√µes:**
1. Verifique se o arquivo √© menor que 100MB
2. Ajuste limites do PHP se necess√°rio:
   ```php
   // php.ini
   upload_max_filesize = 100M
   post_max_size = 100M
   max_execution_time = 300
   ```

#### **AWS S3 n√£o funciona**
**Problema:** Erro ao fazer upload para S3

**Solu√ß√µes:**
1. Verifique credenciais AWS no `.env`
2. Confirme permiss√µes do bucket S3
3. Teste conectividade: `GET /api/videos/validate/s3`
4. Verifique CORS do bucket S3

### üîç Como Debuggar

#### **1. Verificar Logs**
```bash
# Ver √∫ltimos erros
tail -f storage/logs/laravel.log

# Buscar erros espec√≠ficos
grep -i "error" storage/logs/laravel.log
```

#### **2. Testar Endpoints**
```bash
# Testar conectividade
curl -X GET "http://127.0.0.1:8000/api/videos" -H "Accept: application/json"

# Testar valida√ß√£o
curl -X POST "http://127.0.0.1:8000/api/videos" -H "Accept: application/json" -H "X-Requested-With: XMLHttpRequest"
```

#### **3. Verificar Configura√ß√£o**
```bash
# Ver configura√ß√£o S3
php artisan config:show filesystems.disks.s3

# Verificar rotas
php artisan route:list --path=api

# Status das migra√ß√µes
php artisan migrate:status
```

## üìö Documenta√ß√£o

### Recursos Dispon√≠veis

- **`README.md`** - Este guia completo com tudo que voc√™ precisa
- **`tests/scripts/README.md`** - Documenta√ß√£o dos scripts de teste
- **`postman-collection.json`** - Collection Postman com todos os endpoints

### Collection Postman

Importe o arquivo `postman-collection.json` no Postman para testar todos os endpoints da API com exemplos prontos e configura√ß√£o autom√°tica.

### Estrutura do Projeto

```
projeto-video/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ Http/Controllers/VideoController.php    # API Controller
‚îÇ   ‚îú‚îÄ‚îÄ Services/VideoUploadService.php         # Servi√ßo principal
‚îÇ   ‚îú‚îÄ‚îÄ Services/S3FileStorageService.php       # Storage S3
‚îÇ   ‚îú‚îÄ‚îÄ Models/Video.php                        # Model de v√≠deo
‚îÇ   ‚îî‚îÄ‚îÄ Contracts/                              # Interfaces SOLID
‚îú‚îÄ‚îÄ routes/api.php                              # Rotas da API
‚îú‚îÄ‚îÄ tests/Feature/VideoUploadTest.php           # Testes automatizados
‚îî‚îÄ‚îÄ postman-collection.json                    # Collection Postman
```
